#!/usr/bin/env node

var locco     = require("../locco")
var metadata  = require("../package")

var options         = {}
var adapterOptions  = {}

//! Log version and quit if -v flag is found
if (process.argv.indexOf("-v") !== -1) {
  console.log(metadata.version)
  process.exit()
}

//! Pre process command line arguments
process.argv.forEach(function (argument, index) {
  var match

  if (index < 2) return

  //! Match assignable arguments
  if (match = argument.match(/^--([a-zA-Z]+)=(.+)$/))
    options[match[1]] = isNaN(+match[2]) ? match[2] : +match[2]

  //! Match adapter arguments
  if (match = argument.match(/^--adapter-([a-zA-Z]+)=(.+)$/))
    adapterOptions[match[1]] = isNaN(+match[2]) ? match[2] : +match[2]

  //! Match flags without argument
  else if (match = argument.match(/^--([a-z]+)$/))
    options[match[1]] = true

})

options.escapeSequence  = options.escape || "!"
options.commentStart    = options.comment || "//"
options.source          = options.source
options.adapter         = new (require("locco-" + options.adapter))(adapterOptions)

locco(options)
