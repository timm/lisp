<!DOCTYPE html>

<html>
<head>
  <title>eg.lisp</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="eg.html">
                  eg.lisp
                </a>
              
                
                <a class="source" href="es.html">
                  es.lisp
                </a>
              
                
                <a class="source" href="espy.html">
                  espy.lisp
                </a>
              
                
                <a class="source" href="etc.html">
                  etc.lisp
                </a>
              
                
                <a class="source" href="index.html">
                  index.lisp
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>eg.lisp</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <p>vim: ts=2 sw=2 et:</p>
<h1 id="egmd">Eg.md</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>
(<span class="hljs-name">defvar</span> *tests* <span class="hljs-literal">nil</span>)
(<span class="hljs-name">defvar</span> *fails* <span class="hljs-number">0</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <h2 id="unit--tests">Unit  Tests</h2>
<h3 id="deftest">deftest</h3>
<p>Add a function to the <code>\*tests\*</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defmacro</span> deftest (<span class="hljs-name">name</span> params  doc  <span class="hljs-symbol">&amp;body</span> body)
  `(progn (pushnew  &#x27;,name *tests*) 
          (defun ,name ,params ,doc ,@body)))</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <h3 id="demos">demos</h3>
<p>Run the <code>\*tests\*</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> demos (<span class="hljs-name">my</span> <span class="hljs-symbol">&amp;optional</span> what)
  (<span class="hljs-name">dolist</span> (<span class="hljs-name">one</span> *tests*)
    (<span class="hljs-name">let</span> ((<span class="hljs-name">doc</span> (<span class="hljs-name">documentation</span> one &#x27;function)))
    (<span class="hljs-name">when</span> (<span class="hljs-name">or</span> (<span class="hljs-name">not</span> what) (<span class="hljs-name">eql</span> one what))
      (<span class="hljs-name">srand</span> (? my <span class="hljs-symbol">:rand</span> <span class="hljs-symbol">:seed</span>))
      (<span class="hljs-name">multiple-value-bind</span> (<span class="hljs-name">_</span> err)
         (<span class="hljs-name">ignore-errors</span> (<span class="hljs-name">funcall</span> one (<span class="hljs-name">deepcopy</span> my)))
         (<span class="hljs-name">incf</span> *fails* (<span class="hljs-name">if</span> err <span class="hljs-number">1</span> <span class="hljs-number">0</span>))
         (<span class="hljs-name">if</span> err
           (<span class="hljs-name">format</span> <span class="hljs-literal">t</span> <span class="hljs-string">&quot;~&amp;~a [~a] ~a ~a~%&quot;</span> 
             (<span class="hljs-name">red</span> <span class="hljs-string">&quot;✖&quot;</span>) one doc (<span class="hljs-name">yellow</span> err))
           (<span class="hljs-name">format</span> <span class="hljs-literal">t</span> <span class="hljs-string">&quot;~&amp;~a [~a] ~a~%&quot;</span>    
             (<span class="hljs-name">green</span> <span class="hljs-string">&quot;✔&quot;</span>) one doc)))))))

(<span class="hljs-name">deftest</span> _aif (<span class="hljs-name">_</span>)
  <span class="hljs-string">&quot;testing test&quot;</span>
  (<span class="hljs-name">aif</span> (<span class="hljs-name">-</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span>)
    (<span class="hljs-name">want</span> (<span class="hljs-name">=</span> it <span class="hljs-number">1</span>) <span class="hljs-string">&quot;fail?&quot;</span> <span class="hljs-number">2</span>)))

(<span class="hljs-name">deftest</span> _srand (<span class="hljs-name">_</span>)
  <span class="hljs-string">&quot;random number control with srand&quot;</span>
  (<span class="hljs-name">let</span> ((<span class="hljs-name">n</span> <span class="hljs-number">100</span>) a b)
    (<span class="hljs-name">srand</span>)
    (<span class="hljs-name">setf</span> a (<span class="hljs-name">loop</span> for x below  n collect (<span class="hljs-name">randi</span> <span class="hljs-number">1000</span>)) )
    (<span class="hljs-name">srand</span>)
    (<span class="hljs-name">setf</span> b (<span class="hljs-name">loop</span> for x below  n collect (<span class="hljs-name">randi</span> <span class="hljs-number">1000</span>)) )
    (<span class="hljs-name">want</span>  (<span class="hljs-name">equal</span> a b) <span class="hljs-string">&quot;lists not equal&quot;</span>)))

(<span class="hljs-name">deftest</span>  _? (<span class="hljs-name">_</span>)
  <span class="hljs-string">&quot;nested plist access&quot;</span>
  (<span class="hljs-name">let</span> ((<span class="hljs-name">plist</span> &#x27;(<span class="hljs-symbol">:a</span> (:b <span class="hljs-number">23</span> :c <span class="hljs-number">3</span>) <span class="hljs-symbol">:d</span> <span class="hljs-number">4</span>)))
    (<span class="hljs-name">want</span> (<span class="hljs-name">=</span> <span class="hljs-number">4</span> (<span class="hljs-name">incf</span> (? plist <span class="hljs-symbol">:a</span> <span class="hljs-symbol">:c</span>))) <span class="hljs-string">&quot;add one&quot;</span>)))

(<span class="hljs-name">deftest</span> _rnd (<span class="hljs-name">_</span>)
  <span class="hljs-string">&quot;rounding number&quot;</span>
  (<span class="hljs-name">want</span> (<span class="hljs-name">eql</span> (<span class="hljs-name">rnd</span> <span class="hljs-number">3.14157</span> <span class="hljs-number">2</span>) <span class="hljs-number">3.14</span>) <span class="hljs-string">&quot;equal&quot;</span>))

(<span class="hljs-name">deftest</span> _deepcopy (<span class="hljs-name">_</span>)
  (<span class="hljs-name">let*</span> ((<span class="hljs-name">a</span> &#x27;((<span class="hljs-number">10</span>)  <span class="hljs-number">20</span> <span class="hljs-number">30</span> (<span class="hljs-number">40</span> <span class="hljs-number">50</span> <span class="hljs-number">60</span>)))
         (<span class="hljs-name">b</span> (<span class="hljs-name">copy-tree</span> a)))
      (<span class="hljs-name">print</span> a)
      (<span class="hljs-name">print</span> b)
      (<span class="hljs-name">want</span> (<span class="hljs-name">eql</span> <span class="hljs-number">2</span> (<span class="hljs-name">length</span> (<span class="hljs-name">car</span> a))))
      (<span class="hljs-name">want</span> (<span class="hljs-name">eql</span> <span class="hljs-number">20</span> (<span class="hljs-name">second</span> b)))))</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
