<!DOCTYPE html>

<html>
<head>
  <title>tricks.lisp</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>tricks.lisp</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <p><a href="asda">aas</a> <a href="asdaa">2121</a><br><a href="https://GitHub.com/Naereen/StrapDown.js/graphs/commit-activity"><img src="https://img.shields.io/badge/Maintained%3F-yes-green.svg" alt="Maintenance"></a>
<a href="https://GitHub.com/Naereen/ama"><img src="https://img.shields.io/badge/Ask%20me-anything-1abc9c.svg" alt="Ask Me Anything !"></a>
<a href="https://github.com/Naereen/StrapDown.js/blob/master/LICENSE"><img src="https://img.shields.io/github/license/Naereen/StrapDown.js.svg" alt="GitHub license"></a>
<a href="https://GitHub.com/Naereen/StrapDown.js/releases/"><img src="https://img.shields.io/github/release/Naereen/StrapDown.js.svg" alt="GitHub release"></a>
<a href="https://unlicense.org/"><img src="https://img.shields.io/badge/License-Unlicense-blue.svg" alt="Unlicense"></a>  </p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <h2 id="macros">Macros</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <p>After calling <code>(reader #\c fun)</code>, then if
ever we see c(sex) then (sexp) will be
passes to <code>fun</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defmacro</span> reader (<span class="hljs-name">com</span> fun)
  `(set-macro-character ,com 
     #&#x27;(lambda (str _) (declare (ignore _)) (,fun (read str <span class="hljs-literal">t</span> <span class="hljs-literal">nil</span> <span class="hljs-literal">t</span>)))))</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p>Shorthand for recursive calls to slot-value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defmacro</span> ? (<span class="hljs-name">s</span> x <span class="hljs-symbol">&amp;rest</span> xs) 
  (<span class="hljs-name">if</span> xs `(? (slot-value ,s &#x27;,x) ,@xs) `(slot-value ,s &#x27;,x)))</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p>Shorthand for recursive calls to getf</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defmacro</span> ! (<span class="hljs-name">s</span> x <span class="hljs-symbol">&amp;rest</span> xs) (<span class="hljs-name">if</span> xs `(! (getf ,s &#x27;,x) ,@xs) `(getf ,s &#x27;,x)))</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p>Anaphoric if (and <code>it</code> is the anaphoric variable).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defmacro</span> aif (<span class="hljs-name">test</span> yes <span class="hljs-symbol">&amp;optional</span> no) `(let ((it ,test)) (if it ,yes ,no)))</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p>Anaphoric while (and <code>now</code> is the anaphoric variable).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defmacro</span> while (<span class="hljs-name">expr</span> <span class="hljs-symbol">&amp;body</span> body) `(do ((now ,expr ,expr)) ((not now)) ,@body))</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <h2 id="colors">Colors</h2>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <p>all colors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> color (<span class="hljs-name">s</span> c <span class="hljs-symbol">&amp;optional</span> (<span class="hljs-name">str</span> <span class="hljs-literal">t</span>))
  (<span class="hljs-name">let</span> ((<span class="hljs-name">all</span> &#x27;((black . <span class="hljs-number">30</span>) (red . <span class="hljs-number">31</span>) (green . <span class="hljs-number">32</span>)  (yellow . <span class="hljs-number">33</span>) 
               (blue . <span class="hljs-number">34</span>)  (magenta . <span class="hljs-number">35</span>) (cyan . <span class="hljs-number">36</span>) (white .<span class="hljs-number">37</span>))))
    (<span class="hljs-name">format</span> str <span class="hljs-string">&quot;~c[~a;1m~a~c[0m&quot;</span> #\ESC (<span class="hljs-name">cdr</span> (<span class="hljs-name">assoc</span> c all)) s #\ESC)))</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <p>Red, green, yellow</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> red (<span class="hljs-name">s</span>) (<span class="hljs-name">color</span> s &#x27;red <span class="hljs-literal">nil</span>))
(<span class="hljs-name">defun</span> green (<span class="hljs-name">s</span>) (<span class="hljs-name">color</span> s &#x27;green <span class="hljs-literal">nil</span>))
(<span class="hljs-name">defun</span> yellow (<span class="hljs-name">s</span>) (<span class="hljs-name">color</span> s &#x27;yellow <span class="hljs-literal">nil</span>))</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <h2 id="lists">Lists</h2>

            </div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <p>A counter, implemented as an association list.
If <code>x</code> is not there, add it in. 
Return the incremented value. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defmacro</span> inca (<span class="hljs-name">x</span> a <span class="hljs-symbol">&amp;optional</span> (<span class="hljs-name">inc</span>  <span class="hljs-number">1</span>))
  `(incf (cdr (or (assoc ,x ,a :test #&#x27;equal)
                  (car (setf ,a (cons (cons ,x <span class="hljs-number">0</span>) ,a))))) ,inc))</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <p>Entrooy of set of symbols is - sum p*log(p,2)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> entropy (<span class="hljs-name">a</span> <span class="hljs-symbol">&amp;optional</span> (<span class="hljs-name">n</span> <span class="hljs-number">0</span>))
  (<span class="hljs-name">loop</span> for (<span class="hljs-name">_</span> . v) in a do (<span class="hljs-name">incf</span> n v))
  (<span class="hljs-name">loop</span> for (<span class="hljs-name">_</span> . v) in a sum (<span class="hljs-name">*</span> <span class="hljs-number">-1</span> (<span class="hljs-name">/</span> v n) (<span class="hljs-name">log</span> (<span class="hljs-name">/</span> v n) <span class="hljs-number">2</span>))))</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <h2 id="vector">Vector</h2>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <p>Return the nth percentile point.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> per (<span class="hljs-name">a</span> <span class="hljs-symbol">&amp;optional</span> (<span class="hljs-name">nth</span> .<span class="hljs-number">5</span>) <span class="hljs-symbol">&amp;aux</span> (<span class="hljs-name">n</span>  (<span class="hljs-name">length</span> a)))
  (<span class="hljs-name">svref</span> a (<span class="hljs-name">floor</span> (<span class="hljs-name">*</span> nth n))))</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <p>The standard deviation is <code>(90th - 10th)/2,56</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> sd (<span class="hljs-name">a</span> <span class="hljs-symbol">&amp;optional</span> sorted)
  (<span class="hljs-name">if</span> sorted 
    (<span class="hljs-name">/</span> (<span class="hljs-name">-</span> (<span class="hljs-name">per</span> a .<span class="hljs-number">9</span>) (<span class="hljs-name">per</span> a .<span class="hljs-number">1</span>)) <span class="hljs-number">2.56</span>) 
    (<span class="hljs-name">sd</span> (<span class="hljs-name">sort</span> a #&#x27;&lt;) <span class="hljs-literal">t</span>)))</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <h2 id="meta">Meta</h2>

            </div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-19">&#x00a7;</a>
              </div>
              <p>If a string contains a nun, return that num. Else return the string.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> num? (<span class="hljs-name">s</span> <span class="hljs-symbol">&amp;aux</span> (<span class="hljs-name">n</span> (<span class="hljs-name">read-from-string</span> s)))
  (<span class="hljs-name">if</span> (<span class="hljs-name">numberp</span> n) n s))</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-20">&#x00a7;</a>
              </div>
              <p>Turn “?” into #?, else, try for a number.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> s-&gt;cell (<span class="hljs-name">s</span> <span class="hljs-symbol">&amp;aux</span> (<span class="hljs-name">n</span> (<span class="hljs-name">read-from-string</span> s)))
  (<span class="hljs-name">if</span> (<span class="hljs-name">eql</span> <span class="hljs-string">&quot;?&quot;</span> s) #\? (<span class="hljs-name">num</span>? s)))</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-21">&#x00a7;</a>
              </div>
              <p>Does a symbol name start with <code>b4</code>?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> b4-sym (<span class="hljs-name">b4</span> sym <span class="hljs-symbol">&amp;aux</span> (<span class="hljs-name">n</span> (<span class="hljs-name">length</span> b4)) (<span class="hljs-name">s</span> (<span class="hljs-name">symbol-name</span> sym)))
  (<span class="hljs-name">and</span> (<span class="hljs-name">&gt;=</span> (<span class="hljs-name">length</span> s) n) (<span class="hljs-name">equalp</span> b4 (<span class="hljs-name">subseq</span> s <span class="hljs-number">0</span> n))))</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-22">&#x00a7;</a>
              </div>
              <p>Deepcopy</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> deepcopy (<span class="hljs-name">x</span>) (<span class="hljs-name">if</span> (<span class="hljs-name">atom</span> x) x (<span class="hljs-name">mapcar</span> #&#x27;deepcopy x)))</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-23">&#x00a7;</a>
              </div>
              <p>Returns all functions in a package.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> funs (<span class="hljs-name">&amp;optional</span> (<span class="hljs-name">package</span> <span class="hljs-symbol">:common-lisp-user</span>) <span class="hljs-symbol">&amp;aux</span> out)
  (<span class="hljs-name">aif</span> (<span class="hljs-name">find-package</span> package)
    (<span class="hljs-name">do-all-symbols</span> (<span class="hljs-name">s</span> package)
      (<span class="hljs-name">if</span> (<span class="hljs-name">and</span> (<span class="hljs-name">fboundp</span> s) (<span class="hljs-name">eql</span> it (<span class="hljs-name">symbol-package</span> s)))
        (<span class="hljs-name">push</span> s out))))
  out)
(<span class="hljs-name">defun</span> timeit (<span class="hljs-name">function</span>)
  (<span class="hljs-name">let</span> ((<span class="hljs-name">real-base</span> (<span class="hljs-name">get-internal-real-time</span>)))
    (<span class="hljs-name">funcall</span> function)
    (<span class="hljs-name">/</span> (<span class="hljs-name">-</span> (<span class="hljs-name">get-internal-real-time</span>) real-base)
       internal-time-units-per-second)))</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-24">&#x00a7;</a>
              </div>
              <h2 id="comma-seperated-files">Comma-seperated-files</h2>

            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-25">&#x00a7;</a>
              </div>
              <p>split strings on commans</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> s-&gt;cells (<span class="hljs-name">s</span> <span class="hljs-symbol">&amp;optional</span> (<span class="hljs-name">x</span> <span class="hljs-number">0</span>) (<span class="hljs-name">y</span> (<span class="hljs-name">position</span> #\, s <span class="hljs-symbol">:start</span> (<span class="hljs-number">1</span>+ x))))
  (<span class="hljs-name">cons</span> (<span class="hljs-name">s-&gt;cell</span> (<span class="hljs-name">subseq</span> s x y))
        (<span class="hljs-name">and</span> y (<span class="hljs-name">s-&gt;cells</span> s (<span class="hljs-number">1</span>+ y)))))</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-26">&#x00a7;</a>
              </div>
              <p>macro for reading csv files</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defmacro</span> with-csv ((<span class="hljs-name">lst</span> file <span class="hljs-symbol">&amp;optional</span> out) <span class="hljs-symbol">&amp;body</span> body)
   `(progn (csv ,file #&#x27;(lambda (,lst) ,@body)) ,out))</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-27">&#x00a7;</a>
              </div>
              <p>function read csv files</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> csv (<span class="hljs-name">file</span> fun)
  (<span class="hljs-name">with-open-file</span> (<span class="hljs-name">str</span> file)
    (<span class="hljs-name">loop</span> (<span class="hljs-name">funcall</span> fun (<span class="hljs-name">s-&gt;cells</span> (<span class="hljs-name">or</span> (<span class="hljs-name">read-line</span> str <span class="hljs-literal">nil</span>)
                                     (<span class="hljs-name">return-from</span> csv)))))))</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-28">&#x00a7;</a>
              </div>
              <h2 id="system-stuff">System Stuff</h2>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-29">&#x00a7;</a>
              </div>
              <p>Exit LISP.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> halt (<span class="hljs-name">&amp;optional</span> (<span class="hljs-name">status</span> <span class="hljs-number">0</span>)) (<span class="hljs-name">sb-ext</span><span class="hljs-symbol">:exit</span> <span class="hljs-symbol">:code</span> status))</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-30">&#x00a7;</a>
              </div>
              <p>Get command line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> argv () sb-ext<span class="hljs-symbol">:*posix-argv*</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-31">&#x00a7;</a>
              </div>
              <h2 id="command-line-interface">Command-Line Interface</h2>

            </div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-32">&#x00a7;</a>
              </div>
              <p>Given a plist with <code>flags</code>, if  the command line
has any of the same keys, then update <code>flags</code> with the
command-line values.If a flag is <code>all</code> then print some help.
Flags are <code>grouped</code> and the the default group is <code>all</code>.
To change groups, just mention it before mentioning
the flags in that group.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> cli (<span class="hljs-name">flags</span> <span class="hljs-symbol">&amp;key</span> 
                  (<span class="hljs-name">help</span>   <span class="hljs-string">&quot;help&quot;</span>)
                  (<span class="hljs-name">args</span>   (<span class="hljs-name">cdr</span> (<span class="hljs-name">deepcopy</span> (<span class="hljs-name">argv</span>))))
                  (<span class="hljs-name">group</span>  (<span class="hljs-name">getf</span> flags &#x27;all)))
  (<span class="hljs-name">while</span> (<span class="hljs-name">pop</span> args)
    (<span class="hljs-name">setf</span> now (<span class="hljs-name">read-from-string</span> (<span class="hljs-name">remove</span> #\- now)))
    (<span class="hljs-name">cond</span> ((<span class="hljs-name">getf</span> group now)   (<span class="hljs-name">setf</span> (<span class="hljs-name">getf</span> group now) (<span class="hljs-name">num</span>? (<span class="hljs-name">pop</span> args))))
          ((<span class="hljs-name">getf</span> flags now)   (<span class="hljs-name">setf</span> group (<span class="hljs-name">getf</span> flags now)))
          ((<span class="hljs-name">member</span> now group) (<span class="hljs-name">setf</span> (<span class="hljs-name">getf</span> group now) <span class="hljs-literal">t</span>))
          ((<span class="hljs-name">equalp</span> now &#x27;h)    (<span class="hljs-name">format</span> <span class="hljs-literal">t</span> <span class="hljs-string">&quot;~a~%&quot;</span> help))))
  flags)</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-33">&#x00a7;</a>
              </div>
              <p>Just to give an example of its use, suppose we run <code>eg-cl</code>
with this command line:</p>
<p><code>lisp tricks.lisp -loud --dom -k 23 -samples 1</code></p>
<p>The  dashes at the start of the flags are  for human
readers (internally, the code just deletes them).
Since the default group is <code>all</code>, then the
intiial referece to <code>loud</code> is really <code>all loud</code>.
Note how once we change goupds (with <code>dom</code> then
we can set multiple flags in that group.</p>
<p>This will set <code>loud</code> to true and update the other flags: </p>
<pre><code>&gt; (<span class="hljs-name">print</span> (<span class="hljs-name">cli</span> &#x27;(all (tries <span class="hljs-number">0</span>
                     fails <span class="hljs-number">0</span>
                     un    <span class="hljs-literal">nil</span>
                     seed  <span class="hljs-number">10013</span>
                     data  <span class="hljs-string">&quot;../data/aaa.csv&quot;</span>
                     loud  <span class="hljs-literal">nil</span>)
                col (p <span class="hljs-number">2</span>)
                dom (samples <span class="hljs-number">100</span> 
                     k <span class="hljs-number">23</span>))))

 (<span class="hljs-name">ALL</span> (<span class="hljs-name">FAILS</span> <span class="hljs-number">0</span>  
       TRIES <span class="hljs-number">0</span> 
       SEED <span class="hljs-number">11</span> 
       DATA <span class="hljs-string">&quot;../data/aa&quot;</span> 
       LOUD T  
       UN NIL) 
  COL (<span class="hljs-name">P</span> <span class="hljs-number">2</span>) 
  DOM (<span class="hljs-name">SAMPLES</span> <span class="hljs-number">100</span> 
       K <span class="hljs-number">23</span>)) 
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> eg.cli(<span class="hljs-name">_</span>)
  <span class="hljs-string">&quot;demo cli&quot;</span>
  (<span class="hljs-name">pprint</span> (<span class="hljs-name">cli</span> &#x27;(all (fails <span class="hljs-number">0</span>  tries <span class="hljs-number">0</span>
                      seed <span class="hljs-number">10013</span>  
                      data <span class="hljs-string">&quot;../data/aa&quot;</span> 
                      loud <span class="hljs-literal">nil</span> un <span class="hljs-literal">nil</span>)
                 col (p <span class="hljs-number">2</span>)
                 dom (samples <span class="hljs-number">100</span> 
                      k        <span class="hljs-number">23</span>)))))</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-34">&#x00a7;</a>
              </div>
              <h2 id="random-numbers">Random Numbers</h2>

            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-35">&#x00a7;</a>
              </div>
              <p>I confess that I never found a way to do
platform independent random number generation with
CommonLisp. So I write my own.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defvar</span> *seed* <span class="hljs-number">10013</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-36">&#x00a7;</a>
              </div>
              <p>Return a random integer 0.. n-1.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> randi (<span class="hljs-name">&amp;optional</span> (<span class="hljs-name">n</span> <span class="hljs-number">1</span>)) (<span class="hljs-name">floor</span> (<span class="hljs-name">*</span> n (<span class="hljs-name">/</span> (<span class="hljs-name">randf</span> <span class="hljs-number">1000000.0</span>) <span class="hljs-number">1000000</span>))))</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-37">&#x00a7;</a>
              </div>
              <p>Return a random flaot 0..n-1.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> randf (<span class="hljs-name">&amp;optional</span> (<span class="hljs-name">n</span> <span class="hljs-number">1.0</span>)) 
  (<span class="hljs-name">let</span> ((<span class="hljs-name">multiplier</span> <span class="hljs-number">16807.0d0</span>)
        (<span class="hljs-name">modulus</span>    <span class="hljs-number">2147483647.0d0</span>))
    (<span class="hljs-name">setf</span> *seed* (<span class="hljs-name">mod</span> (<span class="hljs-name">*</span> multiplier *seed*) modulus))
    (<span class="hljs-name">*</span> n (<span class="hljs-name">-</span> <span class="hljs-number">1.0d0</span> (<span class="hljs-name">/</span> *seed* modulus)))))</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-38">&#x00a7;</a>
              </div>
              <h2 id="strings">Strings</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defmethod</span> print-object ((<span class="hljs-name">i</span> thing) str)
  (<span class="hljs-name">labels</span> 
    ((<span class="hljs-name">skip</span> (<span class="hljs-name">x</span>) 
           (<span class="hljs-name">and</span> (<span class="hljs-name">symbolp</span> x) (<span class="hljs-name">equal</span> (<span class="hljs-name">elt</span> (<span class="hljs-name">symbol-name</span> x) <span class="hljs-number">0</span>) #\_)))
     (<span class="hljs-name">pairs</span> (<span class="hljs-name">s</span> <span class="hljs-symbol">&amp;aux</span> (<span class="hljs-name">x</span> (<span class="hljs-name">slot-value</span> i s))) 
            (<span class="hljs-name">if</span> x (<span class="hljs-name">list</span> s x) (<span class="hljs-name">list</span> s)))
     (<span class="hljs-name">slots</span> (<span class="hljs-name">klass</span>)
            (<span class="hljs-name">remove-if</span> #&#x27;skip
                       (<span class="hljs-name">mapcar</span> #&#x27;sb-mop<span class="hljs-symbol">:slot-definition-name</span> 
                               (<span class="hljs-name">sb-mop</span><span class="hljs-symbol">:class-slots</span> klass)))))
    (<span class="hljs-name">format</span> 
      str <span class="hljs-string">&quot;{~a~{ ~a~}}&quot;</span> (<span class="hljs-name">class-name</span> (<span class="hljs-name">class-of</span> i)) 
      (<span class="hljs-name">mapcar</span> #&#x27;pairs (<span class="hljs-name">sort</span> (<span class="hljs-name">slots</span> (<span class="hljs-name">class-of</span> i)) #&#x27;string&lt;)))))</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-39">&#x00a7;</a>
              </div>
              <h2 id="start-up">Start-up</h2>

            </div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-40">&#x00a7;</a>
              </div>
              <p>To run one of the examples <code>eg</code>, first reset the <strong>seed</strong>,
take a deepcopy of <code>my</code> (to ensure that any changes ti it
happen isolation.
If <code>un</code>safe is set, then just run the  code.
Else run the code, tracking <code>tries</code>, <code>fails</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> run (<span class="hljs-name">eg</span> my)
  (<span class="hljs-name">setf</span> my      (<span class="hljs-name">deepcopy</span> my)
        *seed*  (! my all seed))
  (<span class="hljs-name">if</span> (! my all meek)
    (<span class="hljs-name">funcall</span> eg my)
    (<span class="hljs-name">multiple-value-bind</span> (<span class="hljs-name">_</span> e)
      (<span class="hljs-name">ignore-errors</span> (<span class="hljs-name">funcall</span> eg my))
      (<span class="hljs-name">incf</span> (! my all tries))
      (<span class="hljs-name">cond</span> (<span class="hljs-name">e</span> (<span class="hljs-name">incf</span> (! my all fails))
               (<span class="hljs-name">format</span> <span class="hljs-literal">t</span> <span class="hljs-string">&quot;~&amp;~a [~a] ~a~%&quot;</span> (<span class="hljs-name">red</span> <span class="hljs-string">&quot;✖&quot;</span>) eg (<span class="hljs-name">yellow</span> e)))
            (<span class="hljs-name">t</span> (<span class="hljs-name">format</span> <span class="hljs-literal">t</span> <span class="hljs-string">&quot;~&amp;~a [~a]~%&quot;</span> (<span class="hljs-name">green</span> <span class="hljs-string">&quot;✔&quot;</span>) eg ))))))</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-41">&#x00a7;</a>
              </div>
              <p>Update <code>my</code> from the command  line.
Run the appropriate test functions  (or if <code>eg</code> is “ls”
then just list everything).
Return to the operating system  the number of failures.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-name">defun</span> main(<span class="hljs-name">my</span> <span class="hljs-symbol">&amp;key</span> (<span class="hljs-name">package</span> <span class="hljs-symbol">:common-lisp-user</span>) (<span class="hljs-name">b4</span> <span class="hljs-string">&quot;EG.&quot;</span>))
  (<span class="hljs-name">let*</span> ((<span class="hljs-name">egs</span> (<span class="hljs-name">loop</span> for fun in (<span class="hljs-name">funs</span> package) 
                if (<span class="hljs-name">b4-sym</span> b4 fun) collect fun))
         (<span class="hljs-name">my</span>  (<span class="hljs-name">cli</span> my))
         (<span class="hljs-name">eg</span>  (<span class="hljs-name">intern</span> (<span class="hljs-name">string-upcase</span> (! my all eg)))))
    (<span class="hljs-name">case</span> eg
      (<span class="hljs-name">all</span> (<span class="hljs-name">loop</span> for fun in egs do (<span class="hljs-name">run</span> fun my)))
      (<span class="hljs-name">ls</span>  (<span class="hljs-name">loop</span> for fun in egs do 
             (<span class="hljs-name">format</span> <span class="hljs-literal">t</span> <span class="hljs-string">&quot;  :eg ~15a : ~a~%&quot;</span> 
                     fun (<span class="hljs-name">or</span> (<span class="hljs-name">documentation</span> fun &#x27;function) <span class="hljs-string">&quot;&quot;</span>))))
      (<span class="hljs-name">otherwise</span> (<span class="hljs-name">when</span> (<span class="hljs-name">member</span> eg egs) (<span class="hljs-name">run</span> eg my))))
    (<span class="hljs-name">halt</span> (! my all fails))))</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
